Configuration reference
=======================

This is the complete config reference:

Override rules: default < set value < set children value

```yaml
kangourouge_messenger:
  repository_namespace: null #Default: Domain\Repository
  entity_namespace: null #Default: Domain\Model
  route_prefix: null #Default: api/
  other_parameters: null
  pagination:
    page: 1
    rows_per_page: 10

  entities:
    {{entity_name}}:
      entity_class: null #Default: Domain\Model\{{EntityName}}
      repository_interface: null  #Default: Domain\Repository\{{EntityNameRepositoryInterface}}
      validation_name: null  #Default: {{entity_name}}
      validation_groups: null
      is_denormalized: false
      is_logged: false
      other_parameters: null

      actions:
        list:
          method: null #Default: GET
          path: null #Default: api/{{entity-names}}
          controller: null #Default: Kangourouge\MessengerBundle\Action\ListAction
          repository_method: null #Default: list
          entity_class: null
          repository_interface: null
          validation_name: null
          validation_groups: null
          is_denormalized: false
          is_logged: false
          other_parameters: null

        list_by_reference:
          #@see src/Resource/config/action/yaml for show specific default values
        retrieve:
          #Same
        create:
          #Same
        update:
          #Same
        patch:
          #Same
        delete:
          #Same
        retrieve_many:
          #Not implemented !
        update_many:
          #Not implemented !
        delete_many:
          #Not implemented !
```

Repository namespace
-----------------

Base namespace for generate repository interface FQNC

**Caution:** customs repository interface are not prefixed

Default: Domain\Repository

Entity namespace
-----------------

Base namespace for generate entity class FQNC

**Caution:** customs entity class are not prefixed

Default: Entity\Model

Route prefix
------------

Prefix all route path autogenerated.

**Caution:** customs route path are not prefixed

Default: api/

Other parameters
----------------

Add custom parameters in "defaults" route config field.

example:

```yaml
# config/package/kangourouge_messenger.yaml
kangourouge_messenger:
    other_parameters:
        oauth2_scopes: ['USER']
````

Is like this

```yaml
# config/route.yaml
retrieve_my_entity:
  path: /api/my-entities/{id}
  methods: GET
  controller: App\Action\RetrieveAction
  defaults:
    oauth2_scopes: ['USER']
````

Pagination
----------

Default pagination parameters for list endpoints

Default:  
 - page: 1  
 - rows_per_page: 10
    
Entities
--------

Each key entries influence several default value.   

Need, at least, one action set in the list below:
 - list
 - list_by_reference (need set path manually)
 - retrieve
 - create
 - update
 - patch
 - delete
 - retrieve_many (not implemented)
 - update_many (not implemented)
 - delete_many (not implemented)

Entity class
------------

Set the entity FQCN use for:

- Validate if resource exist for path like entity/{id} in action
- Denormalize content if "is_denormalized" is true in command handlers

example:

```yaml
# config/package/kangourouge_messenger.yaml
kangourouge_messenger:
  entities:
    my_entity:
      entity_class: ABundleName/Entity/EntityName
````

Is like this

```yaml
# config/route.yaml
retrieve_my_entity:
  path: /api/my-entities/{id}
  methods: GET
  controller: App\Action\RetrieveAction
  defaults:
    __message:
      entity_class: ABundleName/Entity/EntityName
````

Default: {{entity_namespace}}\\{{EntityName}}

Repository interface
--------------------

Set the repository interface FQCN use for load a repository in message handler.

@see [repository registry](./repository_registry.md) (TODO)

example:

```yaml
# config/package/kangourouge_messenger.yaml
kangourouge_messenger:
  entities:
    my_entity:
      repository_interface: ABundleName/Repository/EntityNameRepositoryInterface
````

Is like this

```yaml
# config/route.yaml
retrieve_my_entity:
  path: /api/my-entities/{id}
  methods: GET
  controller: App\Action\RetrieveAction
  defaults:
    __message:
      repository_interface: ABundleName/Repository/EntityNameRepositoryInterface
````

Default: {{repository_namespace}}\\{{EntityNameRepositoryInterface}}

Validation name
---------------

Set the validation name identifier for [validation](./validation.md) mapping.

```yaml
# config/package/kangourouge_messenger.yaml
kangourouge_messenger:
  entities:
    my_entity:
      validation_name: validation_name
````

Is like this

```yaml
# config/route.yaml
retrieve_my_entity:
  path: /api/my-entities/{id}
  methods: GET
  controller: App\Action\RetrieveAction
  defaults:
    __message:
      validation_name: validation_name
````

Default: {{entity_name}}

Validation groups (not implemented)
-----------------

Set Symfony validations groups

Is denormalized
---------------

Call denormalize() set with entity_class in command handlers and use an object instead of array in repository method parameter.

@see [Symfony serializer component](https://symfony.com/doc/current/serializer.html)

Is logged
---------------

If set true, pass the current user id to message handler and add a parameter in repository method call.

example: 
```php
// Infrastructure/Repository/MyRepository
    public function create(string $ressourceId, array $content, string $userId): void
    {
        // Create stuff
    }
````

Repository method
------------------

Set the repository method call in handler.

```yaml
# config/package/kangourouge_messenger.yaml
kangourouge_messenger:
  entities:
    my_entity:
        list:
          actions:
            list:
              repository_method: custom_list
````

Is like this

```yaml
# config/route.yaml
list_my_entity:
  path: /api/my-entities
  methods: GET
  controller: App\Action\RetrieveAction
  defaults:
    __message:
      repository_method: custom_list

default: Depend of action name
